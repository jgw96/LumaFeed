<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="A Progressive Web App for tracking feeding" />
    <title>LumaFeed</title>
    <link rel="manifest" href="/manifest.json" />

    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />

    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1D1B20" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#FEF7FF" />

    <link rel="icon" type="image/png" href="/feedings-65.png" />

    <script>
      // Apply theme immediately to prevent flash
      (function() {
        try {
          const SETTINGS_KEY = 'feeding-tracker-settings';
          const DEFAULT_THEME = '#0061a6';
          const stored = localStorage.getItem(SETTINGS_KEY);
          
          if (!stored) return;
          
          const settings = JSON.parse(stored);
          const themeColor = settings.themeColor || DEFAULT_THEME;
          
          // Validate hex color
          if (!/^#[0-9a-fA-F]{6}$/.test(themeColor)) return;
          
          // Generate theme colors using simplified algorithm
          function hexToHSL(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h = 0, s = 0;
            const l = (max + min) / 2;
            if (max !== min) {
              const d = max - min;
              s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
              switch (max) {
                case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                case g: h = ((b - r) / d + 2) / 6; break;
                case b: h = ((r - g) / d + 4) / 6; break;
              }
            }
            return { h: h * 360, s: s * 100, l: l * 100 };
          }
          
          function hslToHex(h, s, l) {
            s /= 100; l /= 100;
            const c = (1 - Math.abs(2 * l - 1)) * s;
            const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
            const m = l - c / 2;
            let r = 0, g = 0, b = 0;
            if (h >= 0 && h < 60) { r = c; g = x; b = 0; }
            else if (h >= 60 && h < 120) { r = x; g = c; b = 0; }
            else if (h >= 120 && h < 180) { r = 0; g = c; b = x; }
            else if (h >= 180 && h < 240) { r = 0; g = x; b = c; }
            else if (h >= 240 && h < 300) { r = x; g = 0; b = c; }
            else { r = c; g = 0; b = x; }
            const toHex = (n) => {
              const hex = Math.round((n + m) * 255).toString(16);
              return hex.length === 1 ? '0' + hex : hex;
            };
            return '#' + toHex(r) + toHex(g) + toHex(b);
          }
          
          function variant(baseHSL, hd, sd, ld) {
            const h = (baseHSL.h + hd + 360) % 360;
            const s = Math.max(0, Math.min(100, baseHSL.s + sd));
            const l = Math.max(0, Math.min(100, baseHSL.l + ld));
            return hslToHex(h, s, l);
          }
          
          const baseHSL = hexToHSL(themeColor);
          const root = document.documentElement;
          
          // Apply light theme
          root.style.setProperty('--md-sys-color-primary', themeColor);
          root.style.setProperty('--md-sys-color-primary-container', variant(baseHSL, 0, -20, 35));
          root.style.setProperty('--md-sys-color-on-primary-container', variant(baseHSL, 0, 0, -30));
          root.style.setProperty('--md-sys-color-secondary', variant(baseHSL, 25, -30, -10));
          root.style.setProperty('--md-sys-color-secondary-container', variant(baseHSL, 25, -35, 35));
          root.style.setProperty('--md-sys-color-on-secondary-container', variant(baseHSL, 25, -20, -30));
          root.style.setProperty('--md-sys-color-tertiary', variant(baseHSL, -35, -15, -5));
          root.style.setProperty('--md-sys-color-tertiary-container', variant(baseHSL, -35, -20, 40));
          root.style.setProperty('--md-sys-color-on-tertiary-container', variant(baseHSL, -35, -10, -30));
          
          // Apply dark theme colors via CSS (will be picked up by media query)
          const darkPrimary = variant(baseHSL, 0, -10, 30);
          const darkOnPrimary = variant(baseHSL, 0, 10, -25);
          const darkPrimaryContainer = variant(baseHSL, 0, 0, -15);
          const darkOnPrimaryContainer = variant(baseHSL, 0, -20, 35);
          const darkSecondary = variant(baseHSL, 25, -35, 25);
          const darkOnSecondary = variant(baseHSL, 25, -15, -25);
          const darkSecondaryContainer = variant(baseHSL, 25, -25, -20);
          const darkOnSecondaryContainer = variant(baseHSL, 25, -35, 35);
          const darkTertiary = variant(baseHSL, -35, -25, 30);
          const darkOnTertiary = variant(baseHSL, -35, -10, -25);
          const darkTertiaryContainer = variant(baseHSL, -35, -15, -15);
          const darkOnTertiaryContainer = variant(baseHSL, -35, -20, 40);
          
          // Inject dark mode styles
          const style = document.createElement('style');
          style.textContent = `
            @media (prefers-color-scheme: dark) {
              :root {
                --md-sys-color-primary: ${darkPrimary};
                --md-sys-color-on-primary: ${darkOnPrimary};
                --md-sys-color-primary-container: ${darkPrimaryContainer};
                --md-sys-color-on-primary-container: ${darkOnPrimaryContainer};
                --md-sys-color-secondary: ${darkSecondary};
                --md-sys-color-on-secondary: ${darkOnSecondary};
                --md-sys-color-secondary-container: ${darkSecondaryContainer};
                --md-sys-color-on-secondary-container: ${darkOnSecondaryContainer};
                --md-sys-color-tertiary: ${darkTertiary};
                --md-sys-color-on-tertiary: ${darkOnTertiary};
                --md-sys-color-tertiary-container: ${darkTertiaryContainer};
                --md-sys-color-on-tertiary-container: ${darkOnTertiaryContainer};
              }
            }
          `;
          document.head.appendChild(style);
          
          // Update meta theme-color
          const metaLight = document.querySelector('meta[name="theme-color"][media*="light"]');
          const metaDark = document.querySelector('meta[name="theme-color"][media*="dark"]');
          if (metaLight) metaLight.content = variant(baseHSL, 0, -30, 45);
          if (metaDark) metaDark.content = variant(baseHSL, 0, 10, -25);
        } catch (e) {
          // Silently fail - will use default theme
        }
      })();
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      /* Remove default outline for mouse users, keep for keyboard */
      *:focus:not(:focus-visible) {
        outline: none;
      }

      *:focus-visible {
        outline: 2px solid var(--md-sys-color-primary);
        outline-offset: 2px;
      }

      html.dialog-scroll-locked,
      html.dialog-scroll-locked body {
        overflow: hidden;
        overscroll-behavior: contain;
      }

      :root {
        color-scheme: light dark;

        /* Material 3 Light Theme - Blue Design */
        --md-sys-color-primary: #0061a6;
        --md-sys-color-on-primary: #ffffff;
        --md-sys-color-primary-container: #d0e4ff;
        --md-sys-color-on-primary-container: #001d36;

        --md-sys-color-secondary: #535f70;
        --md-sys-color-on-secondary: #ffffff;
        --md-sys-color-secondary-container: #d7e3f7;
        --md-sys-color-on-secondary-container: #101c2b;

        --md-sys-color-tertiary: #6b5778;
        --md-sys-color-on-tertiary: #ffffff;
        --md-sys-color-tertiary-container: #f2daff;
        --md-sys-color-on-tertiary-container: #251431;

        --md-sys-color-error: #ba1a1a;
        --md-sys-color-on-error: #ffffff;
        --md-sys-color-error-container: #ffdad6;
        --md-sys-color-on-error-container: #410002;

        --md-sys-color-background: #f8fbff;
        --md-sys-color-on-background: #1a1c1e;

        --md-sys-color-surface: #f8fbff;
        --md-sys-color-on-surface: #1a1c1e;
        --md-sys-color-surface-variant: #dfe2eb;
        --md-sys-color-on-surface-variant: #43474e;

        --md-sys-color-surface-container-lowest: #ffffff;
        --md-sys-color-surface-container-low: #f2f5f9;
        --md-sys-color-surface-container: #eceff3;
        --md-sys-color-surface-container-high: #e6e9ee;
        --md-sys-color-surface-container-highest: #e0e3e8;

        --md-sys-color-outline: #73777f;
        --md-sys-color-outline-variant: #c3c6cf;

        --md-sys-color-shadow: #000000;
        --md-sys-color-scrim: #000000;

        /* Elevation shadows */
        --md-sys-elevation-0: none;
        --md-sys-elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        --md-sys-elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
        --md-sys-elevation-3: 0px 1px 3px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
        --md-sys-elevation-4: 0px 2px 3px rgba(0, 0, 0, 0.3), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
        --md-sys-elevation-5: 0px 4px 4px rgba(0, 0, 0, 0.3), 0px 8px 12px 6px rgba(0, 0, 0, 0.15);

        /* Typography */
        --md-sys-typescale-display-large-font-size: 57px;
        --md-sys-typescale-display-large-line-height: 64px;
        --md-sys-typescale-display-large-font-weight: 400;

        --md-sys-typescale-headline-large-font-size: 32px;
        --md-sys-typescale-headline-large-line-height: 40px;
        --md-sys-typescale-headline-large-font-weight: 400;

        --md-sys-typescale-title-large-font-size: 22px;
        --md-sys-typescale-title-large-line-height: 28px;
        --md-sys-typescale-title-large-font-weight: 400;

        --md-sys-typescale-body-large-font-size: 16px;
        --md-sys-typescale-body-large-line-height: 24px;
        --md-sys-typescale-body-large-font-weight: 400;

        --md-sys-typescale-label-large-font-size: 14px;
        --md-sys-typescale-label-large-line-height: 20px;
        --md-sys-typescale-label-large-font-weight: 500;

        /* Shape */
        --md-sys-shape-corner-none: 0px;
        --md-sys-shape-corner-extra-small: 4px;
        --md-sys-shape-corner-small: 8px;
        --md-sys-shape-corner-medium: 12px;
        --md-sys-shape-corner-large: 16px;
        --md-sys-shape-corner-extra-large: 28px;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          /* Material 3 Dark Theme - Blue Design */
          --md-sys-color-primary: #9ccaff;
          --md-sys-color-on-primary: #003258;
          --md-sys-color-primary-container: #00497d;
          --md-sys-color-on-primary-container: #d0e4ff;

          --md-sys-color-secondary: #bbc7db;
          --md-sys-color-on-secondary: #253140;
          --md-sys-color-secondary-container: #3c4858;
          --md-sys-color-on-secondary-container: #d7e3f7;

          --md-sys-color-tertiary: #d6bee4;
          --md-sys-color-on-tertiary: #3b2948;
          --md-sys-color-tertiary-container: #523f5f;
          --md-sys-color-on-tertiary-container: #f2daff;

          --md-sys-color-error: #ffb4ab;
          --md-sys-color-on-error: #690005;
          --md-sys-color-error-container: #93000a;
          --md-sys-color-on-error-container: #ffdad6;

          --md-sys-color-background: #1a1c1e;
          --md-sys-color-on-background: #e2e2e5;

          --md-sys-color-surface: #1a1c1e;
          --md-sys-color-on-surface: #e2e2e5;
          --md-sys-color-surface-variant: #43474e;
          --md-sys-color-on-surface-variant: #c3c6cf;

          --md-sys-color-surface-container-lowest: #0f1113;
          --md-sys-color-surface-container-low: #1a1c1e;
          --md-sys-color-surface-container: #1e2022;
          --md-sys-color-surface-container-high: #282a2d;
          --md-sys-color-surface-container-highest: #333538;

          --md-sys-color-outline: #8d9199;
          --md-sys-color-outline-variant: #43474e;

          --md-sys-color-shadow: #000000;
          --md-sys-color-scrim: #000000;
        }
      }

      body {
        margin: 0;
        font-family:
          'Roboto',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Oxygen,
          Ubuntu,
          Cantarell,
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: var(--md-sys-color-background);
        color: var(--md-sys-color-on-background);
      }
    </style>
  </head>

  <body>
    <app-root></app-root>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
